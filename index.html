
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Martin's MathBlaster</title>
<style>
  :root{
    --blue-900:#0a1e40;
    --blue-700:#123b7a;
    --blue-600:#1b55b3;
    --blue-500:#2a6fdb;
    --blue-300:#84aef2;
    --blue-100:#e7f0ff;
    --white:#ffffff;
  }
  *{box-sizing:border-box}
  body{
    margin:0; padding:0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    background: radial-gradient(1200px 800px at 50% -10%, var(--blue-300), var(--blue-900));
    color: var(--white);
    min-height:100vh;
    display:flex; align-items:center; justify-content:center;
  }
  .card{
    width: min(900px, 92vw);
    background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.06));
    border: 1px solid rgba(255,255,255,0.15);
    box-shadow: 0 20px 60px rgba(0,0,0,0.35);
    border-radius: 22px;
    padding: 22px;
    backdrop-filter: blur(6px);
  }
  h1{
    margin:10px 0 6px;
    font-size: clamp(24px, 3.4vw, 40px);
    letter-spacing: .5px;
    text-align:center;
  }
  .subtitle{opacity:.9; text-align:center; margin:0 0 18px}
  .hero{
    display:flex; align-items:center; justify-content:center; gap:18px; flex-wrap:wrap;
    margin-bottom: 14px;
  }
  .martin-anim{
    width: 140px; height:140px; border-radius: 24px; overflow:hidden; position:relative;
    border: 3px solid var(--blue-300);
    box-shadow: 0 0 0 0 rgba(255,255,255,0.65);
    animation: glow 2.2s ease-in-out infinite, float 3.4s ease-in-out infinite;
  }
  .martin-anim img{ width:100%; height:100%; object-fit:cover; display:block;}
  @keyframes glow{
    0%{ box-shadow:0 0 0 0 rgba(132,174,242,.9) }
    60%{ box-shadow:0 0 30px 8px rgba(132,174,242,.35) }
    100%{ box-shadow:0 0 0 0 rgba(132,174,242,0) }
  }
  @keyframes float{
    0%,100%{ transform: translateY(0) }
    50%{ transform: translateY(-8px) }
  }
  .panel{
    background: rgba(255,255,255,0.08);
    border:1px solid rgba(255,255,255,0.18);
    border-radius:16px;
    padding:16px;
  }
  .row{display:flex; gap:12px; align-items:center; justify-content:center; flex-wrap:wrap}
  #question{ font-size: clamp(20px, 3vw, 30px); font-weight:700; }
  input[type="number"]{
    font-size: 20px; padding:10px 12px; border-radius:12px; border:none; width:140px;
    text-align:center;
  }
  button{
    background: var(--blue-500);
    color:#fff; border:none; border-radius:12px; padding:12px 18px; font-size:18px;
    cursor:pointer; transition:.2s transform ease, .2s opacity ease, .2s background ease;
  }
  button:hover{ transform: translateY(-1px); background: var(--blue-600) }
  .small{ font-size:14px; opacity:.9; }
  .bar-wrap{
    width:100%; background: rgba(255,255,255,.18); border-radius:10px; height:12px; overflow:hidden;
  }
  .bar{
    height:100%; width:100%; background: linear-gradient(90deg, var(--blue-300), var(--blue-100));
    transition: width .2s linear;
  }
  .center-pop{
    display:none; margin: 14px auto 4px; text-align:center;
  }
  .center-pop img{
    width:300px; height:300px; object-fit:cover; border-radius:16px; display:block; margin:0 auto;
    border: 3px solid var(--blue-300); background:#0002;
  }
  #feedback{ font-size: 20px; margin-top:8px; min-height:26px; text-align:center}
  #meta{display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap}
  #score, #progress{ font-weight:600 }
  .pill{ background: rgba(255,255,255,.14); padding:6px 10px; border-radius:999px; }
  .muter{ background: transparent; border:1px solid rgba(255,255,255,.35); }
</style>
</head>
<body>
<div class="card">
  <div class="hero">
    <div class="martin-anim">
      <img src="MARTIN_CARTOON_small.png" alt="Martin" />
    </div>
    <div>
      <h1>Welcome to Martin's MathBlaster</h1>
      <p class="subtitle">Blue edition Â· Harder questions Â· 15â€‘second timer</p>
      <div id="meta">
        <div class="pill" id="progress">Q <span id="qnum">1</span>/20</div>
        <div class="pill" id="score">Score: <span id="pts">0</span></div>
        <button id="muteBtn" class="pill muter" aria-pressed="false">ðŸ”Š Sound On</button>
      </div>
    </div>
  </div>

  <div class="panel">
    <div id="question" aria-live="polite"></div>
    <div class="bar-wrap" aria-label="Timer">
      <div id="timebar" class="bar"></div>
    </div>
    <div class="row" style="margin-top:10px;">
      <input type="number" id="answer" placeholder="Your answer" inputmode="numeric"/>
      <button id="submitBtn">Submit</button>
    </div>
    <div id="feedback" role="status"></div>
    <div class="center-pop" id="pop">
      <img id="resultImage" alt="Reaction"/>
      <div id="popText" class="subtitle" style="margin-top:6px"></div>
    </div>
  </div>
</div>

<audio id="correctSound" src="https://www.soundjay.com/buttons/sounds/button-3.mp3" preload="auto"></audio>
<audio id="wrongSound" src="https://www.soundjay.com/buttons/sounds/button-10.mp3" preload="auto"></audio>

<script>
  // --- State
  const TOTAL = 20;
  let questions = [];
  let score = 0;
  let current = 0;
  let muted = false;
  let timer = null;
  const limitMs = 15000; // 15s per question
  let endTime = 0;

  // --- Elements
  const qEl = document.getElementById('question');
  const aEl = document.getElementById('answer');
  const sBtn = document.getElementById('submitBtn');
  const fbEl = document.getElementById('feedback');
  const bar = document.getElementById('timebar');
  const pop = document.getElementById('pop');
  const popImg = document.getElementById('resultImage');
  const popText = document.getElementById('popText');
  const ptsEl = document.getElementById('pts');
  const qnumEl = document.getElementById('qnum');
  const muteBtn = document.getElementById('muteBtn');
  const sndCorrect = document.getElementById('correctSound');
  const sndWrong = document.getElementById('wrongSound');

  // --- Utility: play a sound respecting mute
  function play(sound){ if(!muted){ try{ sound.currentTime = 0; sound.play(); } catch(e){} } }

  muteBtn.addEventListener('click', () => {
    muted = !muted;
    muteBtn.textContent = muted ? 'ðŸ”‡ Sound Off' : 'ðŸ”Š Sound On';
    muteBtn.setAttribute('aria-pressed', String(!muted));
  });

  // --- Generate harder grade-6 style questions (mixed ops, integer division)
  function randInt(min, max){ return Math.floor(Math.random()*(max-min+1))+min; }

  function makeQuestion(){
    // pick type: 0:+- big numbers | 1:* up to 15x15 | 2: integer division | 3: mix a*b + c or a+b*c
    const t = randInt(0,3);
    let text, answer;
    if(t===0){
      const a = randInt(25,120), b = randInt(25,120);
      if(Math.random()<0.5){ text = `${a} + ${b}`; answer = a+b; }
      else { const big = a+b; text = `${big} - ${a}`; answer = b; }
    } else if(t===1){
      const a = randInt(7,15), b = randInt(7,15);
      text = `${a} Ã— ${b}`; answer = a*b;
    } else if(t===2){
      const b = randInt(6,12);
      const a = b * randInt(6,15); // ensures integer
      text = `${a} Ã· ${b}`; answer = a/b;
    } else {
      if(Math.random()<0.5){
        const a = randInt(6,15), b = randInt(6,12), c = randInt(10,40);
        text = `${a} Ã— ${b} + ${c}`; answer = a*b+c;
      } else {
        const a = randInt(20,60), b = randInt(3,9), c = randInt(2,9);
        text = `${a} + ${b} Ã— ${c}`; answer = a + b*c;
      }
    }
    return {text, answer};
  }

  function generateQuestions(){
    questions.length = 0;
    for(let i=0;i<TOTAL;i++){ questions.push(makeQuestion()); }
  }

  function startTimer(){
    endTime = Date.now() + limitMs;
    updateBar();
    timer = setInterval(updateBar, 80);
  }
  function stopTimer(){
    if(timer){ clearInterval(timer); timer = null; }
  }
  function updateBar(){
    const remaining = Math.max(0, endTime - Date.now());
    const pct = (remaining/limitMs)*100;
    bar.style.width = pct + '%';
    if(remaining<=0){
      stopTimer();
      autoTimeOut();
    }
  }

  function showQuestion(){
    pop.style.display = 'none';
    fbEl.textContent = '';
    const q = questions[current];
    qEl.textContent = `Question ${current+1}: ${q.text}`;
    qnumEl.textContent = String(current+1);
    aEl.value = '';
    aEl.focus();
    startTimer();
  }

  function mark(correct){
    pop.style.display = 'block';
    if(correct){
      score++;
      ptsEl.textContent = String(score);
      fbEl.textContent = 'Good job!';
      popImg.src = 'MUM_small.jpg';
      popText.textContent = 'Mum is proud of you!';
      play(sndCorrect);
    } else {
      fbEl.textContent = 'Come on Martin!';
      popImg.src = 'DAD_small.jpg';
      popText.textContent = 'Papa is angry ðŸ˜  (but still loves you)';
      play(sndWrong);
    }
    setTimeout(nextStep, 1200);
  }

  function autoTimeOut(){
    // Treat as incorrect when time runs out
    fbEl.textContent = 'Timeâ€™s up!';
    mark(false);
  }

  function checkAnswer(){
    stopTimer();
    const user = parseInt(aEl.value,10);
    const correct = (user === questions[current].answer);
    mark(correct);
  }

  function nextStep(){
    current++;
    if(current < questions.length){
      showQuestion();
    } else {
      endScreen();
    }
  }

  function endScreen(){
    document.body.innerHTML = `
      <div class="card" style="text-align:center;">
        <h1>Your Score: ${score} / ${questions.length}</h1>
        <div class="center-pop" style="display:block">
          <img src="SISTER_small.jpg" alt="Sister" style="margin-top:10px"/>
          <div class="subtitle" style="margin-top:8px">You got it from your sister!</div>
        </div>
        <p class="subtitle" style="margin-top:16px">
          <button onclick="location.reload()">Play Again</button>
        </p>
      </div>
    `;
  }

  // wire up
  sBtn.addEventListener('click', checkAnswer);
  aEl.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ checkAnswer(); } });

  // Start
  generateQuestions();
  showQuestion();
</script>
</body>
</html>
